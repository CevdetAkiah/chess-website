{"ast":null,"code":"var _jsxFileName = \"/home/cevdet/go-projects/chess-website/_chess-client/chess-client/src/pages/Game/index.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect, useContext } from 'react';\nimport './game.css';\nimport { Chess } from 'chess.js';\nimport { createBoard } from '../../functions/create-board';\nimport Board from '../../components/board';\nimport { GameContext } from '../../context/GameContext';\nimport { setMessage, setOpponent, setOpponentColour, setOpponentMoves, setPlayer, setPlayerColour, types } from '../../context/actions';\nimport { getGameOverState } from '../../functions';\nimport GameOver from '../../components/gameover';\nimport UserForm from '../../components/userform';\n\n// import io from 'socket.io-client';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst serverURL = 'ws://localhost:8080/ws';\n\n// const socket = io('localhost:8080/socket.io/', {\n//     transports: ['websocket']\n// });\nconst FEN = 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1';\n// checkmate for testing game over screen\n// const FEN = 'rnb1kbnr/pppp1ppp/8/4p3/5PPq/8/PPPPP2P/RNBQKBNR w KQkq - 1 3';\n\nconst ws = new WebSocket(serverURL);\nconst Game = () => {\n  _s();\n  const [fen, setFen] = useState(FEN);\n  const {\n    current: chess\n  } = useRef(new Chess(fen));\n  const [board, setBoard] = useState(createBoard(fen));\n  const {\n    gameOver\n  } = useContext(GameContext);\n  const {\n    possibleMoves,\n    dispatch,\n    message,\n    playerColour,\n    opponentColour,\n    playerName,\n    opponentName\n  } = useContext(GameContext);\n  useEffect(() => {\n    ws.onopen = event => {\n      console.log(\"connection established: \", event);\n      const apiRequest = {\n        emit: \"join\",\n        user: {\n          name: \"John\"\n        }\n      };\n      ws.send(JSON.stringify(apiRequest));\n    };\n    ws.onerror = err => {\n      console.log(err);\n    };\n    ws.onmessage = event => {\n      const msgReceived = JSON.parse(event.data);\n      const emit = msgReceived.emit;\n      switch (emit) {\n        case 'message':\n          console.log(msgReceived.message);\n          break;\n        case 'start':\n          if (msgReceived.pcolour == \"w\") {\n            // TODO: allow players to choose colour and change server to put player1 as white and player 2 as black. Player must always be set to white on the client\n            dispatch(setPlayer(msgReceived.pname));\n            dispatch(setPlayerColour(msgReceived.pcolour));\n            dispatch(setOpponent(msgReceived.oname));\n            dispatch(setOpponentColour(msgReceived.ocolour));\n          } else {\n            dispatch(setPlayer(msgReceived.oname));\n            dispatch(setPlayerColour(msgReceived.ocolour));\n            dispatch(setOpponent(msgReceived.pname));\n            dispatch(setOpponentColour(msgReceived.pcolour));\n          }\n          break;\n        case 'opponentMove':\n          const from = msgReceived.from;\n          const to = msgReceived.to;\n          console.log(\"FROM: \", from, \"TO: \", to);\n          // chess.move({ from, to })\n          dispatch(setOpponentMoves([from, to]));\n          setFen(chess.fen()); // update the fen with the new move/piece positions\n\n          break;\n      }\n      ;\n\n      // ws.send(JSON.stringify({emit:\"message\", message: \"PLAYER: \" + playerColour + \" OPPONENT: \" + opponentName}))\n    };\n\n    ws.onclose = event => {\n      console.log(\"connection closed: \", event);\n    };\n  }, [dispatch, chess, opponentColour, opponentName, playerColour, playerName]);\n\n  // useEffect(() => {\n\n  //     const interval = setInterval(() => {\n  //       console.log(\"PLAYERNAME: \", playerName);\n  //       console.log(\"PLAYERCOLOUR: \", playerColour);\n  //       console.log(\"OPPONENTNAME: \", opponentName);\n  //       console.log(\"OPPONENTCOLOUR: \", opponentColour);\n  //     }, 5000); // Adjust the interval (in milliseconds) as needed\n\n  //     return () => {\n  //       clearInterval(interval); // Cleanup the interval when the component unmounts\n  //     };\n  //   }, [dispatch, chess, opponentColour, opponentName, playerColour, playerName]);\n\n  // // every time a change is made to the state of the game, the board is updated with the new fen\n  // useEffect(() =>{\n  //     setBoard(createBoard(fen));\n  // }, [fen]);\n\n  // will detect if a player is in check\n  useEffect(() => {\n    const [gameOver, status] = getGameOverState(chess);\n    if (gameOver) {\n      dispatch({\n        type: types.GAME_OVER,\n        status,\n        player: chess.turn()\n      });\n      return;\n    }\n    dispatch({\n      type: types.SET_TURN,\n      player: chess.turn(),\n      check: chess.isCheck()\n    });\n  }, [fen, dispatch, chess]);\n\n  /** move handling */\n  const fromPos = useRef(); /** follow setFromPos to the piece component */\n\n  // share move set with components\n\n  const makeMove = pos => {\n    const from = fromPos.current;\n    const to = pos;\n    var validMove = possibleMoves.includes(to);\n    if (validMove) {\n      chess.move({\n        from,\n        to\n      });\n      const apiRequest = {\n        emit: \"move\",\n        gameID: 1,\n        from: from,\n        to: to\n      };\n      ws.send(JSON.stringify(apiRequest));\n      dispatch({\n        type: types.CLEAR_POSSIBLE_MOVES\n      }); // unhighlight possible moves\n      setFen(chess.fen()); // update the fen with the new move/piece positions\n    }\n  };\n\n  // this is called once a piece is dragged\n  const setFromPos = pos => {\n    fromPos.current = pos;\n    dispatch({\n      type: types.SET_POSSIBLE_MOVES,\n      moves: chess.moves({\n        square: pos\n      }) // send the possible moves from the currently selected position to highlight\n    });\n  };\n\n  // if (gameOver) {\n  //     return <GameOver />\n  // };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"game\",\n    children: /*#__PURE__*/_jsxDEV(Board, {\n      cells: board,\n      makeMove: makeMove,\n      setFromPos: setFromPos\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 163,\n    columnNumber: 13\n  }, this);\n};\n_s(Game, \"Z5CX7jBbvOZKq5Wmtr2adPlo2GM=\");\n_c = Game;\nexport default Game;\nvar _c;\n$RefreshReg$(_c, \"Game\");","map":{"version":3,"names":["React","useState","useRef","useEffect","useContext","Chess","createBoard","Board","GameContext","setMessage","setOpponent","setOpponentColour","setOpponentMoves","setPlayer","setPlayerColour","types","getGameOverState","GameOver","UserForm","jsxDEV","_jsxDEV","serverURL","FEN","ws","WebSocket","Game","_s","fen","setFen","current","chess","board","setBoard","gameOver","possibleMoves","dispatch","message","playerColour","opponentColour","playerName","opponentName","onopen","event","console","log","apiRequest","emit","user","name","send","JSON","stringify","onerror","err","onmessage","msgReceived","parse","data","pcolour","pname","oname","ocolour","from","to","onclose","status","type","GAME_OVER","player","turn","SET_TURN","check","isCheck","fromPos","makeMove","pos","validMove","includes","move","gameID","CLEAR_POSSIBLE_MOVES","setFromPos","SET_POSSIBLE_MOVES","moves","square","className","children","cells","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/home/cevdet/go-projects/chess-website/_chess-client/chess-client/src/pages/Game/index.jsx"],"sourcesContent":["import React, { useState, useRef, useEffect, useContext} from 'react';\nimport './game.css';\nimport {Chess} from 'chess.js';\nimport { createBoard } from '../../functions/create-board';\nimport Board from  '../../components/board';\nimport { GameContext } from '../../context/GameContext';\nimport {     \n    setMessage,\n    setOpponent,\n    setOpponentColour,\n    setOpponentMoves,\n    setPlayer,\n    setPlayerColour,\n    types, } from '../../context/actions';\nimport { getGameOverState } from '../../functions';\nimport  GameOver from '../../components/gameover';\nimport UserForm from '../../components/userform';\n\n// import io from 'socket.io-client';\nconst serverURL = 'ws://localhost:8080/ws'\n\n\n\n// const socket = io('localhost:8080/socket.io/', {\n//     transports: ['websocket']\n// });\nconst FEN = 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1';\n// checkmate for testing game over screen\n// const FEN = 'rnb1kbnr/pppp1ppp/8/4p3/5PPq/8/PPPPP2P/RNBQKBNR w KQkq - 1 3';\n\nconst ws = new WebSocket(serverURL)\n\n\n\nconst Game = ()=> {\n    const[fen, setFen] = useState(FEN);\n    const {current: chess} = useRef(new Chess(fen));\n    const [board,setBoard] = useState(createBoard(fen));\n    const {gameOver} = useContext(GameContext);\n    const { possibleMoves, dispatch, message, playerColour, opponentColour, playerName, opponentName } = useContext(GameContext);\n\n    useEffect(() => {\n        ws.onopen = (event) =>{\n            console.log(\"connection established: \", event)\n            \n            const apiRequest = {emit: \"join\", user : {name : \"John\"}}\n            ws.send(JSON.stringify(apiRequest)) \n        }\n        ws.onerror = (err) => {\n            console.log(err)\n        }\n\n        ws.onmessage = (event) => {\n            const msgReceived = JSON.parse(event.data)\n            const emit = msgReceived.emit\n            switch (emit) {\n                case 'message':\n                    console.log(msgReceived.message) \n                    break;\n                case 'start':\n                    if (msgReceived.pcolour == \"w\"){ // TODO: allow players to choose colour and change server to put player1 as white and player 2 as black. Player must always be set to white on the client\n                        dispatch(setPlayer(msgReceived.pname))\n                        dispatch(setPlayerColour(msgReceived.pcolour))\n                        dispatch(setOpponent(msgReceived.oname))\n                        dispatch(setOpponentColour(msgReceived.ocolour))                        \n                    }else{\n                        dispatch(setPlayer(msgReceived.oname))\n                        dispatch(setPlayerColour(msgReceived.ocolour))\n                        dispatch(setOpponent(msgReceived.pname))\n                        dispatch(setOpponentColour(msgReceived.pcolour))  \n                    }\n                    break;\n                case 'opponentMove':\n                    const from = msgReceived.from\n                    const to = msgReceived.to\n                    console.log(\"FROM: \", from, \"TO: \", to)\n                    // chess.move({ from, to })\n                    dispatch(setOpponentMoves([from,to]))\n            setFen(chess.fen()); // update the fen with the new move/piece positions\n\n                    break;\n                };\n                               \n                // ws.send(JSON.stringify({emit:\"message\", message: \"PLAYER: \" + playerColour + \" OPPONENT: \" + opponentName}))\n            }\n\n            \n\n        ws.onclose = (event) => {\n            console.log(\"connection closed: \", event)\n        }\n    },[dispatch, chess, opponentColour, opponentName, playerColour, playerName])\n\n    // useEffect(() => {\n    \n    //     const interval = setInterval(() => {\n    //       console.log(\"PLAYERNAME: \", playerName);\n    //       console.log(\"PLAYERCOLOUR: \", playerColour);\n    //       console.log(\"OPPONENTNAME: \", opponentName);\n    //       console.log(\"OPPONENTCOLOUR: \", opponentColour);\n    //     }, 5000); // Adjust the interval (in milliseconds) as needed\n    \n    //     return () => {\n    //       clearInterval(interval); // Cleanup the interval when the component unmounts\n    //     };\n    //   }, [dispatch, chess, opponentColour, opponentName, playerColour, playerName]);\n    \n\n    // // every time a change is made to the state of the game, the board is updated with the new fen\n    // useEffect(() =>{\n    //     setBoard(createBoard(fen));\n    // }, [fen]);\n\n\n\n    // will detect if a player is in check\n    useEffect(() =>{\n        const [gameOver, status] = getGameOverState(chess);\n        if (gameOver) {\n            dispatch({ type: types.GAME_OVER, status, player: chess.turn() });\n            return\n        }\n        dispatch({\n            type: types.SET_TURN,\n            player: chess.turn(),\n            check: chess.isCheck(),\n        });\n    }, [fen, dispatch, chess]);\n\n    /** move handling */ \n    const fromPos = useRef(); /** follow setFromPos to the piece component */\n\n    // share move set with components\n\n    const makeMove = (pos) =>{\n        const from = fromPos.current;\n        const to = pos;\n\n        var validMove = possibleMoves.includes(to)\n         if (validMove){\n            chess.move({ from, to });\n            const apiRequest = {emit: \"move\", gameID: 1, from: from, to: to }\n            ws.send(JSON.stringify(apiRequest))\n            dispatch({ type: types.CLEAR_POSSIBLE_MOVES}) // unhighlight possible moves\n            setFen(chess.fen()); // update the fen with the new move/piece positions\n        }\n    };\n\n    // this is called once a piece is dragged\n    const setFromPos = (pos) => {\n        fromPos.current = pos\n        dispatch({\n            type:types.SET_POSSIBLE_MOVES,\n            moves: chess.moves({ square: pos }) // send the possible moves from the currently selected position to highlight\n        })\n    };\n\n    // if (gameOver) {\n    //     return <GameOver />\n    // };\n\n    return (\n            <div className=\"game\">\n            <Board cells = {board} makeMove={makeMove} setFromPos={setFromPos}/>\n            </div>\n    );\n\n};\n\nexport default Game;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}