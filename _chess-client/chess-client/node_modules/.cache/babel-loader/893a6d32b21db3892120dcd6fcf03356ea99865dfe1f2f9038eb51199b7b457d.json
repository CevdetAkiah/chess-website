{"ast":null,"code":"var _jsxFileName = \"/home/cevdet/go-projects/react-chess/chess-client/src/pages/Game/index.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect, useContext } from 'react';\nimport { Chess } from 'chess.js';\nimport { createBoard } from '../../functions/create-board';\nimport Board from '../../components/board';\nimport { GameContext } from '../../context/GameContext';\nimport { types } from '../../context/actions';\nimport { getGameOverState } from '../../functions';\nimport GameOver from '../../components/gameover';\nimport io from 'socket.io-client';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst socket = io('http://localhost:5000');\nconst FEN = 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1';\n// checkmate for testing game over screen\n// const FEN = 'rnb1kbnr/pppp1ppp/8/4p3/5PPq/8/PPPPP2P/RNBQKBNR w KQkq - 1 3';\nconst Game = () => {\n  _s();\n  const [fen, setFen] = useState(FEN);\n  const {\n    current: chess\n  } = useRef(new Chess(fen));\n  const [board, setBoard] = useState(createBoard(fen));\n  const {\n    gameOver\n  } = useContext(GameContext);\n  const {\n    possibleMoves,\n    dispatch\n  } = useContext(GameContext);\n  console.log('Socket connection started ', socket.active);\n\n  // listening for events from the server\n  useEffect(() => {\n    socket.connect();\n    console.log(socket.active);\n    socket.on('connect_error', error => {\n      console, error('Websocket connection error: ', error);\n    });\n    socket.on('connect', () => {\n      console.log(socket);\n      console.log('Socket connected');\n      socket.emit('join', {\n        name: 'Frank',\n        gameID: '20'\n      }, ({\n        error,\n        color\n      }) => {\n        console.log({\n          color\n        });\n      });\n      socket.on('Welcome', ({\n        message,\n        opponent\n      }) => {\n        console.log({\n          message,\n          opponent\n        });\n      });\n      socket.on('opponentJoin', ({\n        message,\n        opponent\n      }) => {\n        console.log({\n          message,\n          opponent\n        });\n      });\n      socket.on('opponentMove', ({\n        from,\n        to\n      }) => {\n        chess.move({\n          from,\n          to\n        });\n        setFen(chess.fen());\n      });\n    });\n  }, [chess]);\n\n  // every time a change is made to the state of the game, the board is updated with the new fen\n  useEffect(() => {\n    setBoard(createBoard(fen));\n  }, [fen]);\n\n  // will detect if a player is in check\n  useEffect(() => {\n    const [gameOver, status] = getGameOverState(chess);\n    if (gameOver) {\n      dispatch({\n        type: types.GAME_OVER,\n        status,\n        player: chess.turn()\n      });\n      return;\n    }\n    dispatch({\n      type: types.SET_TURN,\n      player: chess.turn(),\n      check: chess.isCheck()\n    });\n  }, [fen, dispatch, chess]);\n\n  /** move handling */\n  const fromPos = useRef(); /** follow setFromPos to the piece component */\n\n  // share move set with components\n\n  const makeMove = pos => {\n    const from = fromPos.current;\n    const to = pos;\n    var validMove = possibleMoves.includes(to);\n    if (validMove) {\n      chess.move({\n        from,\n        to\n      });\n    }\n    dispatch({\n      type: types.CLEAR_POSSIBLE_MOVES\n    }); // unhighlight possible moves\n    setFen(chess.fen()); // update the fen with the new move/piece positions\n    socket.emit('move', {\n      gameID: '20',\n      from,\n      to: pos\n    }); // send moves to the other player through the websocket\n  };\n\n  // this is called once a piece is dragged\n  const setFromPos = pos => {\n    fromPos.current = pos;\n    dispatch({\n      type: types.SET_POSSIBLE_MOVES,\n      moves: chess.moves({\n        square: pos\n      }) // send the possible moves from the currently selected position to highlight\n    });\n  };\n\n  if (gameOver) {\n    return /*#__PURE__*/_jsxDEV(GameOver, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 12\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"game\",\n    children: /*#__PURE__*/_jsxDEV(Board, {\n      cells: board,\n      makeMove: makeMove,\n      setFromPos: setFromPos\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 5\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 107,\n    columnNumber: 8\n  }, this);\n};\n_s(Game, \"NoDznaP8jUE1UDA7FTg2kNmBGDY=\");\n_c = Game;\nexport default Game;\nvar _c;\n$RefreshReg$(_c, \"Game\");","map":{"version":3,"names":["React","useState","useRef","useEffect","useContext","Chess","createBoard","Board","GameContext","types","getGameOverState","GameOver","io","jsxDEV","_jsxDEV","socket","FEN","Game","_s","fen","setFen","current","chess","board","setBoard","gameOver","possibleMoves","dispatch","console","log","active","connect","on","error","emit","name","gameID","color","message","opponent","from","to","move","status","type","GAME_OVER","player","turn","SET_TURN","check","isCheck","fromPos","makeMove","pos","validMove","includes","CLEAR_POSSIBLE_MOVES","setFromPos","SET_POSSIBLE_MOVES","moves","square","fileName","_jsxFileName","lineNumber","columnNumber","className","children","cells","_c","$RefreshReg$"],"sources":["/home/cevdet/go-projects/react-chess/chess-client/src/pages/Game/index.jsx"],"sourcesContent":["import React, { useState, useRef, useEffect, useContext} from 'react';\nimport {Chess} from 'chess.js';\nimport { createBoard } from '../../functions/create-board';\nimport Board from  '../../components/board';\nimport { GameContext } from '../../context/GameContext';\nimport { types } from '../../context/actions';\nimport { getGameOverState } from '../../functions';\nimport  GameOver from '../../components/gameover';\nimport io from 'socket.io-client';\n\n\nconst socket = io('http://localhost:5000');\nconst FEN = 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1';\n// checkmate for testing game over screen\n// const FEN = 'rnb1kbnr/pppp1ppp/8/4p3/5PPq/8/PPPPP2P/RNBQKBNR w KQkq - 1 3';\nconst Game = ()=> {\n    const[fen, setFen] = useState(FEN);\n    const {current: chess} = useRef(new Chess(fen));\n    const [board,setBoard] = useState(createBoard(fen));\n    const {gameOver} = useContext(GameContext);\n    const { possibleMoves, dispatch } = useContext(GameContext);\n    console.log('Socket connection started ', socket.active)\n    \n    // listening for events from the server\n    useEffect(() => {\n        socket.connect();\n        console.log(socket.active)\n        socket.on('connect_error', (error) => {\n            console,error('Websocket connection error: ', error)\n        })\n        socket.on('connect', () => {\n        console.log(socket)\n        console.log('Socket connected');\n        socket.emit('join', { name: 'Frank', gameID: '20' }, ({ error, color }) => {\n            console.log({ color });\n        });\n        socket.on('Welcome', ({ message, opponent }) => {\n            console.log({ message, opponent });\n        });\n        socket.on('opponentJoin', ({ message, opponent }) => {\n            console.log({ message, opponent });\n        });\n    \n        socket.on('opponentMove', ({ from, to }) => {\n            chess.move({ from, to });\n            setFen(chess.fen());\n        });\n    })\n\n}, [chess]);\n\n\n \n    // every time a change is made to the state of the game, the board is updated with the new fen\n    useEffect(() =>{\n        setBoard(createBoard(fen));\n    }, [fen]);\n\n\n    // will detect if a player is in check\n    useEffect(() =>{\n        const [gameOver, status] = getGameOverState(chess);\n        if (gameOver) {\n            dispatch({ type: types.GAME_OVER, status, player: chess.turn() });\n            return\n        }\n        dispatch({\n            type: types.SET_TURN,\n            player: chess.turn(),\n            check: chess.isCheck(),\n        });\n    }, [fen, dispatch, chess]);\n\n    /** move handling */\n    const fromPos = useRef(); /** follow setFromPos to the piece component */\n\n    // share move set with components\n\n    const makeMove = (pos) =>{\n        const from = fromPos.current;\n        const to = pos;\n        var validMove = possibleMoves.includes(to)\n         if (validMove){\n            chess.move({ from, to });\n        }\n        dispatch({ type: types.CLEAR_POSSIBLE_MOVES}) // unhighlight possible moves\n        setFen(chess.fen()); // update the fen with the new move/piece positions\n        socket.emit('move', { gameID: '20', from, to: pos}) // send moves to the other player through the websocket\n    };\n\n    // this is called once a piece is dragged\n    const setFromPos = (pos) => {\n        fromPos.current = pos\n        dispatch({\n            type:types.SET_POSSIBLE_MOVES,\n            moves: chess.moves({ square: pos }) // send the possible moves from the currently selected position to highlight\n        })\n    }\n\n\n\n\n\nif (gameOver) {\n    return <GameOver />\n}\nreturn <div className=\"game\">\n    <Board cells = {board} makeMove={makeMove} setFromPos={setFromPos}/>\n</div>\n\n}\n\nexport default Game;"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,MAAM,EAAEC,SAAS,EAAEC,UAAU,QAAO,OAAO;AACrE,SAAQC,KAAK,QAAO,UAAU;AAC9B,SAASC,WAAW,QAAQ,8BAA8B;AAC1D,OAAOC,KAAK,MAAO,wBAAwB;AAC3C,SAASC,WAAW,QAAQ,2BAA2B;AACvD,SAASC,KAAK,QAAQ,uBAAuB;AAC7C,SAASC,gBAAgB,QAAQ,iBAAiB;AAClD,OAAQC,QAAQ,MAAM,2BAA2B;AACjD,OAAOC,EAAE,MAAM,kBAAkB;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAGlC,MAAMC,MAAM,GAAGH,EAAE,CAAC,uBAAuB,CAAC;AAC1C,MAAMI,GAAG,GAAG,0DAA0D;AACtE;AACA;AACA,MAAMC,IAAI,GAAGA,CAAA,KAAK;EAAAC,EAAA;EACd,MAAK,CAACC,GAAG,EAAEC,MAAM,CAAC,GAAGnB,QAAQ,CAACe,GAAG,CAAC;EAClC,MAAM;IAACK,OAAO,EAAEC;EAAK,CAAC,GAAGpB,MAAM,CAAC,IAAIG,KAAK,CAACc,GAAG,CAAC,CAAC;EAC/C,MAAM,CAACI,KAAK,EAACC,QAAQ,CAAC,GAAGvB,QAAQ,CAACK,WAAW,CAACa,GAAG,CAAC,CAAC;EACnD,MAAM;IAACM;EAAQ,CAAC,GAAGrB,UAAU,CAACI,WAAW,CAAC;EAC1C,MAAM;IAAEkB,aAAa;IAAEC;EAAS,CAAC,GAAGvB,UAAU,CAACI,WAAW,CAAC;EAC3DoB,OAAO,CAACC,GAAG,CAAC,4BAA4B,EAAEd,MAAM,CAACe,MAAM,CAAC;;EAExD;EACA3B,SAAS,CAAC,MAAM;IACZY,MAAM,CAACgB,OAAO,CAAC,CAAC;IAChBH,OAAO,CAACC,GAAG,CAACd,MAAM,CAACe,MAAM,CAAC;IAC1Bf,MAAM,CAACiB,EAAE,CAAC,eAAe,EAAGC,KAAK,IAAK;MAClCL,OAAO,EAACK,KAAK,CAAC,8BAA8B,EAAEA,KAAK,CAAC;IACxD,CAAC,CAAC;IACFlB,MAAM,CAACiB,EAAE,CAAC,SAAS,EAAE,MAAM;MAC3BJ,OAAO,CAACC,GAAG,CAACd,MAAM,CAAC;MACnBa,OAAO,CAACC,GAAG,CAAC,kBAAkB,CAAC;MAC/Bd,MAAM,CAACmB,IAAI,CAAC,MAAM,EAAE;QAAEC,IAAI,EAAE,OAAO;QAAEC,MAAM,EAAE;MAAK,CAAC,EAAE,CAAC;QAAEH,KAAK;QAAEI;MAAM,CAAC,KAAK;QACvET,OAAO,CAACC,GAAG,CAAC;UAAEQ;QAAM,CAAC,CAAC;MAC1B,CAAC,CAAC;MACFtB,MAAM,CAACiB,EAAE,CAAC,SAAS,EAAE,CAAC;QAAEM,OAAO;QAAEC;MAAS,CAAC,KAAK;QAC5CX,OAAO,CAACC,GAAG,CAAC;UAAES,OAAO;UAAEC;QAAS,CAAC,CAAC;MACtC,CAAC,CAAC;MACFxB,MAAM,CAACiB,EAAE,CAAC,cAAc,EAAE,CAAC;QAAEM,OAAO;QAAEC;MAAS,CAAC,KAAK;QACjDX,OAAO,CAACC,GAAG,CAAC;UAAES,OAAO;UAAEC;QAAS,CAAC,CAAC;MACtC,CAAC,CAAC;MAEFxB,MAAM,CAACiB,EAAE,CAAC,cAAc,EAAE,CAAC;QAAEQ,IAAI;QAAEC;MAAG,CAAC,KAAK;QACxCnB,KAAK,CAACoB,IAAI,CAAC;UAAEF,IAAI;UAAEC;QAAG,CAAC,CAAC;QACxBrB,MAAM,CAACE,KAAK,CAACH,GAAG,CAAC,CAAC,CAAC;MACvB,CAAC,CAAC;IACN,CAAC,CAAC;EAEN,CAAC,EAAE,CAACG,KAAK,CAAC,CAAC;;EAIP;EACAnB,SAAS,CAAC,MAAK;IACXqB,QAAQ,CAAClB,WAAW,CAACa,GAAG,CAAC,CAAC;EAC9B,CAAC,EAAE,CAACA,GAAG,CAAC,CAAC;;EAGT;EACAhB,SAAS,CAAC,MAAK;IACX,MAAM,CAACsB,QAAQ,EAAEkB,MAAM,CAAC,GAAGjC,gBAAgB,CAACY,KAAK,CAAC;IAClD,IAAIG,QAAQ,EAAE;MACVE,QAAQ,CAAC;QAAEiB,IAAI,EAAEnC,KAAK,CAACoC,SAAS;QAAEF,MAAM;QAAEG,MAAM,EAAExB,KAAK,CAACyB,IAAI,CAAC;MAAE,CAAC,CAAC;MACjE;IACJ;IACApB,QAAQ,CAAC;MACLiB,IAAI,EAAEnC,KAAK,CAACuC,QAAQ;MACpBF,MAAM,EAAExB,KAAK,CAACyB,IAAI,CAAC,CAAC;MACpBE,KAAK,EAAE3B,KAAK,CAAC4B,OAAO,CAAC;IACzB,CAAC,CAAC;EACN,CAAC,EAAE,CAAC/B,GAAG,EAAEQ,QAAQ,EAAEL,KAAK,CAAC,CAAC;;EAE1B;EACA,MAAM6B,OAAO,GAAGjD,MAAM,CAAC,CAAC,CAAC,CAAC;;EAE1B;;EAEA,MAAMkD,QAAQ,GAAIC,GAAG,IAAI;IACrB,MAAMb,IAAI,GAAGW,OAAO,CAAC9B,OAAO;IAC5B,MAAMoB,EAAE,GAAGY,GAAG;IACd,IAAIC,SAAS,GAAG5B,aAAa,CAAC6B,QAAQ,CAACd,EAAE,CAAC;IACzC,IAAIa,SAAS,EAAC;MACXhC,KAAK,CAACoB,IAAI,CAAC;QAAEF,IAAI;QAAEC;MAAG,CAAC,CAAC;IAC5B;IACAd,QAAQ,CAAC;MAAEiB,IAAI,EAAEnC,KAAK,CAAC+C;IAAoB,CAAC,CAAC,EAAC;IAC9CpC,MAAM,CAACE,KAAK,CAACH,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;IACrBJ,MAAM,CAACmB,IAAI,CAAC,MAAM,EAAE;MAAEE,MAAM,EAAE,IAAI;MAAEI,IAAI;MAAEC,EAAE,EAAEY;IAAG,CAAC,CAAC,EAAC;EACxD,CAAC;;EAED;EACA,MAAMI,UAAU,GAAIJ,GAAG,IAAK;IACxBF,OAAO,CAAC9B,OAAO,GAAGgC,GAAG;IACrB1B,QAAQ,CAAC;MACLiB,IAAI,EAACnC,KAAK,CAACiD,kBAAkB;MAC7BC,KAAK,EAAErC,KAAK,CAACqC,KAAK,CAAC;QAAEC,MAAM,EAAEP;MAAI,CAAC,CAAC,CAAC;IACxC,CAAC,CAAC;EACN,CAAC;;EAML,IAAI5B,QAAQ,EAAE;IACV,oBAAOX,OAAA,CAACH,QAAQ;MAAAkD,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC;EACvB;EACA,oBAAOlD,OAAA;IAAKmD,SAAS,EAAC,MAAM;IAAAC,QAAA,eACxBpD,OAAA,CAACP,KAAK;MAAC4D,KAAK,EAAI5C,KAAM;MAAC6B,QAAQ,EAAEA,QAAS;MAACK,UAAU,EAAEA;IAAW;MAAAI,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAC;EAAC;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACnE,CAAC;AAEN,CAAC;AAAA9C,EAAA,CA/FKD,IAAI;AAAAmD,EAAA,GAAJnD,IAAI;AAiGV,eAAeA,IAAI;AAAC,IAAAmD,EAAA;AAAAC,YAAA,CAAAD,EAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}